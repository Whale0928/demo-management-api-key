# API 키 관리 시스템

## 개요

API 키 발급 및 관리 기능을 구현하여 API 서버의 **보안성과 효율성**을 향상시킨다.

이를 통해 요청자를 식별하고, 요청 횟수를 검증하며, 무단 사용을 방지한다.

### 핵심 요구사항

- **사용자 식별 정보 수집**
    - 이름, 인증된 이메일
- **키의 권한 설정**
    - 필터링 모드 종류 선택
- **사용할 서버의 정보 수집**
    - IP 주소 또는 도메인
- **보안 강화**
    - 요청자 식별 및 인증
    - 요청 횟수 제한으로 자원 남용 방지
    - 블랙리스트를 통한 무단 사용 및 공격 대응

## 시스템 설계

### API 키 구성

- **JWT 기반 구현**
    - 최소한의 필수 정보만 포함
    - 서명과 만료 시간 설정으로 보안 강화
    - 권한 정보 포함

### 검증 및 보안

- **IP 기반 접근 제어**
    - 허용된 IP 범위 내 요청만 처리
    - IP 화이트리스트 관리
- **요청 횟수 관리**
    - Redis 기반 실시간 카운팅
    - 분 단위 집계 및 DB 동기화
    - 사용량 초과 시 차단
- **블랙리스트 관리**
    - 비정상 행위 감지 시 IP/토큰 차단
    - 차단 이력 관리

### 실시간 요청 카운팅 시스템

#### 구현 상세

1. **데이터 구조**
    - Redis 키: `client:{id}:count`
    - 값: 현재 집계 기간의 요청 횟수

2. **처리 플로우**
   ```
   API 요청 → AOP 인터셉트 → Redis 카운트 증가 →
   매 분 주기로 → DB 동기화 → 카운트 초기화
   ```

3. **모니터링**
    - 클라이언트별 사용량 추적
    - 비정상 패턴 감지
    - 시스템 상태 모니터링

### 키 관리

- **유효 기간 관리**
    - 키별 만료 기간 설정
    - 만료 예정 알림
    - 자동 갱신 옵션
- **키 갱신/폐기**
    - 간단한 갱신 프로세스
    - 즉시 폐기 기능
    - 폐기 사유 추적

### 메타데이터 관리

- 민감 정보 서버 측 저장
- 사용 이력 및 통계 관리
- 감사 로그 기록

## 기술 스택

- **Backend**: Spring Boot
- **Database**: PostgreSQL
- **Cache**: Redis
- **Security**: Spring Security, JWT

## 참조

- JWT 표준 및 보안 권장사항
- Spring Boot 보안 모범 사례
- API 키 관리 업계 가이드라인
